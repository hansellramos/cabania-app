generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accommodations {
  created_at       DateTime  @default(now()) @db.Timestamptz(6)
  venue            String?   @db.Uuid
  date             DateTime? @db.Date
  duration         Decimal?  @db.Decimal
  time             DateTime? @db.Time(6)
  customer         String?   @db.Uuid
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  adults           Int?      @default(0)
  children         Int?      @default(0)
  agreed_price     Decimal?  @db.Decimal
  calculated_price Decimal?  @db.Decimal
  plan_id          String?   @db.Uuid
}

model payments {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at     DateTime  @default(now()) @db.Timestamptz(6)
  accommodation  String?   @db.Uuid
  amount         Decimal?  @db.Decimal
  payment_method String?   @db.VarChar(100)
  payment_date   DateTime? @db.Date
  reference      String?   @db.VarChar(255)
  notes          String?
  receipt_url    String?
  verified       Boolean   @default(false)
  verified_at    DateTime? @db.Timestamptz(6)
  verified_by    String?   @db.VarChar(255)
  created_by     String?   @db.VarChar(255)
  updated_at     DateTime? @db.Timestamptz(6)
  updated_by     String?   @db.VarChar(255)
  type           String?   @db.VarChar(50)
}

model contact_organization {
  contact      String   @db.Uuid
  organization String   @db.Uuid
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  type         String   @db.VarChar

  @@id([contact, organization])
}

model contact_venue {
  venue      String   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  contact    String   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at DateTime @default(now()) @db.Timestamptz(6)
  type       String   @db.VarChar

  @@id([venue, contact])
}

model contacts {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at DateTime @default(now()) @db.Timestamptz(6)
  fullname   String?  @db.VarChar
  whatsapp   Decimal? @db.Decimal
  city       String?  @db.VarChar
  state      String?  @db.VarChar
  country    String?  @db.VarChar
  user       String?  @db.Uuid
}

model countries {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  iso        String   @db.VarChar
  iso3       String?  @db.VarChar
  name       String?  @db.VarChar
  phone_code Decimal? @db.Decimal
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model organizations {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String?  @db.VarChar
  system     Boolean? @default(false)
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model package_prices {
  name           String    @default("Default")
  price          Decimal   @db.Decimal
  start          DateTime? @db.Timestamp(6)
  end            DateTime? @db.Timestamp(6)
  default        Boolean   @default(false)
  is_discount    Boolean?  @default(false)
  discount_type  String?   @db.VarChar
  discount_value Decimal?  @db.Decimal
  created_at     DateTime  @default(now()) @db.Timestamptz(6)
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  package        String?   @db.Uuid
}

model states {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String?  @db.VarChar
  country    String?  @db.VarChar
  iso        String?  @db.VarChar
  iso3       String?  @db.VarChar
  zip        String?  @db.VarChar
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model users {
  id             String    @id @db.VarChar(255)
  email          String?
  display_name   String?
  avatar_url     String?
  created_at     DateTime? @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  preferences    Json?     @default("{}") @db.Json
  is_locked      Boolean?  @default(false)
  locked_at      DateTime? @db.Timestamptz(6)
  locked_by      String?   @db.VarChar(255)
  role           String?   @default("user") @db.VarChar(50)
  is_super_admin Boolean   @default(false)
  profile_id     String?   @db.Uuid
  password_hash  String?   @db.VarChar(255)
  profile        profiles? @relation(fields: [profile_id], references: [id])
}

model permissions {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code        String   @unique @db.VarChar(100)
  name        String   @db.VarChar(255)
  description String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
}

model profiles {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code        String   @unique @db.VarChar(100)
  name        String   @db.VarChar(255)
  description String?
  permissions Json     @default("[]") @db.Json
  is_system   Boolean  @default(false)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  users       users[]
}

model user_organizations {
  user_id         String   @db.VarChar(255)
  organization_id String   @db.Uuid
  created_at      DateTime @default(now()) @db.Timestamptz(6)

  @@id([user_id, organization_id])
}

model subscriptions {
  id                     String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String               @db.VarChar(255)
  description            String?
  is_active              Boolean              @default(true)
  stripe_customer_id     String?              @db.VarChar(255)
  stripe_subscription_id String?              @db.VarChar(255)
  plan_type              String               @default("free") @db.VarChar(50)
  max_users              Int                  @default(5)
  max_organizations      Int                  @default(1)
  starts_at              DateTime?            @db.Timestamptz(6)
  expires_at             DateTime?            @db.Timestamptz(6)
  created_at             DateTime             @default(now()) @db.Timestamptz(6)
  updated_at             DateTime             @default(now()) @updatedAt @db.Timestamptz(6)
  subscription_users     subscription_users[]
}

model subscription_users {
  id               String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  subscription_id  String        @db.Uuid
  user_id          String        @db.VarChar(255)
  role             String        @default("member") @db.VarChar(50)
  is_owner         Boolean       @default(false)
  added_at         DateTime      @default(now()) @db.Timestamptz(6)
  added_by         String?       @db.VarChar(255)
  trial_expires_at DateTime?     @db.Timestamptz(6)
  subscription     subscriptions @relation(fields: [subscription_id], references: [id], onDelete: Cascade)

  @@unique([subscription_id, user_id])
}

model venue_packages {
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  venue       String?  @db.Uuid
  name        String?
  description String?
  features    Json[]   @db.Json
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
}

model venues {
  id                   String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String?       @db.VarChar
  created_at           DateTime      @default(now()) @db.Timestamptz(6)
  whatsapp             Decimal?      @db.Decimal
  address              String?       @db.VarChar
  zip_code             String?       @db.VarChar
  latitude             Float?
  longitude            Float?
  city                 String?       @db.VarChar
  country              String?       @db.VarChar
  department           String?       @db.VarChar
  suburb               String?       @db.VarChar
  address_reference    String?
  instagram            String?       @db.VarChar
  organization         String?       @db.Uuid
  is_public            Boolean       @default(false)
  waze_link            String?
  google_maps_link     String?
  default_llm_provider String?       @db.Uuid
  delivery_info        String?
  venue_info           String?
  wifi_password        String?       @db.VarChar(100)
  wifi_ssid            String?       @db.VarChar(100)
  venue_plans          venue_plans[]
}

model sessions {
  sid    String   @id @db.VarChar(255)
  sess   Json
  expire DateTime @db.Timestamptz(6)

  @@index([expire], map: "IDX_session_expire")
}

model incomes {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payment_id      String?   @unique @db.Uuid
  organization_id String?   @db.Uuid
  venue_id        String?   @db.Uuid
  amount          Decimal?  @db.Decimal
  type            String?   @db.VarChar(50)
  date            DateTime? @db.Date
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
}

model amenities {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String   @db.VarChar(255)
  description String?
  icon        String?  @db.VarChar(100)
  category    String?  @db.VarChar(100)
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
}

model venue_plans {
  id                      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  venue_id                String   @db.Uuid
  name                    String   @db.VarChar(255)
  plan_type               String   @db.VarChar(50)
  description             String?
  adult_price             Decimal  @db.Decimal
  child_price             Decimal  @db.Decimal
  infant_max_age          Int      @default(2)
  child_max_age           Int      @default(12)
  free_children_qty       Int?     @default(0)
  free_children_max_age   Int?
  free_children_condition String?
  child_food_price        Decimal? @db.Decimal
  min_guests              Int      @default(1)
  max_capacity            Int?
  check_in_time           String?  @db.VarChar(10)
  check_out_time          String?  @db.VarChar(10)
  includes_overnight      Boolean  @default(false)
  includes_rooms          Boolean  @default(false)
  includes_food           Boolean  @default(false)
  food_description        String?
  includes_beverages      Boolean  @default(false)
  terms_conditions        String?
  is_active               Boolean  @default(true)
  created_at              DateTime @default(now()) @db.Timestamptz(6)
  venue                   venues   @relation(fields: [venue_id], references: [id], onDelete: Cascade)
}

model plan_amenities {
  plan_id    String   @db.Uuid
  amenity_id String   @db.Uuid
  quantity   Int?     @default(1)
  notes      String?  @db.VarChar(255)
  created_at DateTime @default(now()) @db.Timestamptz(6)

  @@id([plan_id, amenity_id])
}

model plan_images {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  plan_id    String   @db.Uuid
  image_url  String
  is_cover   Boolean  @default(false)
  sort_order Int      @default(0)
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model venue_images {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  venue_id   String   @db.Uuid
  image_url  String
  is_cover   Boolean  @default(false)
  sort_order Int      @default(0)
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model venue_amenities {
  venue_id   String   @db.Uuid
  amenity_id String   @db.Uuid
  notes      String?  @db.VarChar(255)
  created_at DateTime @default(now()) @db.Timestamptz(6)

  @@id([venue_id, amenity_id])
}

model expense_categories {
  id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String     @db.VarChar(100)
  description String?
  icon        String?    @db.VarChar(50)
  color       String?    @db.VarChar(20)
  is_system   Boolean    @default(false)
  is_active   Boolean    @default(true)
  created_at  DateTime   @default(now()) @db.Timestamptz(6)
  expenses    expenses[]
}

model expenses {
  id               String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id  String?                   @db.Uuid
  venue_id         String?                   @db.Uuid
  category_id      String?                   @db.Uuid
  amount           Decimal                   @db.Decimal
  description      String?
  expense_date     DateTime                  @db.Date
  reference        String?                   @db.VarChar(255)
  receipt_url      String?
  notes            String?
  created_by       String?                   @db.VarChar(255)
  created_at       DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?                 @db.Timestamptz(6)
  updated_by       String?                   @db.VarChar(255)
  provider_id      String?                   @db.Uuid
  subcategory      String?                   @db.VarChar(100)
  accommodation_id String?                   @db.Uuid
  inventory_items  expense_inventory_items[]
  category         expense_categories?       @relation(fields: [category_id], references: [id])
  provider         providers?                @relation(fields: [provider_id], references: [id])
}

model providers {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String             @db.VarChar(255)
  organization_id  String?            @db.Uuid
  phone            String?            @db.VarChar(50)
  email            String?            @db.VarChar(255)
  address          String?
  notes            String?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @db.Timestamptz(6)
  expenses         expenses[]
  maintenance_logs maintenance_logs[]
}

model deposits {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  accommodation_id String             @db.Uuid
  venue_id         String?            @db.Uuid
  organization_id  String?            @db.Uuid
  amount           Decimal            @db.Decimal
  status           String             @default("pending") @db.VarChar(50)
  payment_method   String?            @db.VarChar(100)
  payment_date     DateTime?          @db.Date
  reference        String?            @db.VarChar(255)
  receipt_url      String?
  refund_amount    Decimal?           @db.Decimal
  refund_date      DateTime?          @db.Date
  refund_reference String?            @db.VarChar(255)
  damage_amount    Decimal?           @db.Decimal
  damage_notes     String?
  notes            String?
  created_by       String?            @db.VarChar(255)
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @db.Timestamptz(6)
  updated_by       String?            @db.VarChar(255)
  verified         Boolean            @default(false)
  verified_at      DateTime?          @db.Timestamptz(6)
  verified_by      String?            @db.VarChar(255)
  evidence         deposit_evidence[]
}

model deposit_evidence {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  deposit_id  String   @db.Uuid
  image_url   String
  type        String   @db.VarChar(50)
  description String?
  sort_order  Int      @default(0)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  deposit     deposits @relation(fields: [deposit_id], references: [id], onDelete: Cascade)
}

model llm_providers {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code       String    @unique @db.VarChar(50)
  name       String    @db.VarChar(100)
  api_key    String?
  base_url   String?
  model      String?   @db.VarChar(100)
  is_active  Boolean   @default(true)
  is_default Boolean   @default(false)
  config     Json?     @db.Json
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamptz(6)
}

model ai_settings {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  setting_key   String    @unique @db.VarChar(50)
  provider_code String    @db.VarChar(50)
  model         String    @db.VarChar(100)
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @db.Timestamptz(6)
}

model message_templates {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  venue_id        String?   @db.Uuid
  code            String    @db.VarChar(50)
  name            String    @db.VarChar(255)
  category        String?   @db.VarChar(50)
  content         String
  variables       Json?     @db.Json
  is_system       Boolean   @default(false)
  is_active       Boolean   @default(true)
  sort_order      Int       @default(0)
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @db.Timestamptz(6)
  twilio_template String?   @db.VarChar(255)

  @@unique([venue_id, code])
}

model chat_conversations {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  venue_id    String          @db.Uuid
  external_id String?         @db.VarChar(255)
  source      String          @db.VarChar(50)
  phone       String?         @db.VarChar(50)
  name        String?         @db.VarChar(255)
  metadata    Json?           @db.Json
  created_at  DateTime        @default(now()) @db.Timestamptz(6)
  updated_at  DateTime?       @db.Timestamptz(6)
  messages    chat_messages[]
}

model chat_messages {
  id              String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  conversation_id String             @db.Uuid
  role            String             @db.VarChar(20)
  content         String
  provider        String?            @db.VarChar(50)
  model           String?            @db.VarChar(100)
  tokens_used     Int?
  cost            Decimal?           @db.Decimal
  created_at      DateTime           @default(now()) @db.Timestamptz(6)
  conversation    chat_conversations @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
}

model estimates {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  venue_id         String    @db.Uuid
  plan_id          String?   @db.Uuid
  customer_name    String?   @db.VarChar(255)
  contact_type     String    @db.VarChar(20)
  contact_value    String    @db.VarChar(100)
  check_in         DateTime? @db.Date
  check_out        DateTime? @db.Date
  adults           Int?      @default(0)
  children         Int?      @default(0)
  calculated_price Decimal?  @db.Decimal
  notes            String?
  status           String    @default("pending") @db.VarChar(50)
  conversation_id  String?   @db.Uuid
  created_by       String?   @db.VarChar(255)
  created_at       DateTime  @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @db.Timestamptz(6)
  converted_at     DateTime? @db.Timestamptz(6)
  accommodation_id String?   @db.Uuid
  agreed_price     Decimal?  @db.Decimal
  discount_note    String?
}

model inventory_categories {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id String?           @db.Uuid
  name            String            @db.VarChar(255)
  description     String?
  icon            String?           @db.VarChar(100)
  color           String?           @db.VarChar(50)
  type            String?           @default("both") @db.VarChar(20)
  is_active       Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?         @default(now()) @db.Timestamptz(6)
  inventory_items inventory_items[]
}

model inventory_items {
  id                   String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id      String?                   @db.Uuid
  venue_id             String?                   @db.Uuid
  category_id          String?                   @db.Uuid
  type                 String                    @db.VarChar(20)
  name                 String                    @db.VarChar(255)
  description          String?
  quantity             Decimal?                  @default(0) @db.Decimal
  unit                 String?                   @db.VarChar(50)
  minimum_stock        Decimal?                  @db.Decimal
  unit_cost            Decimal?                  @db.Decimal
  condition            String?                   @db.VarChar(50)
  location             String?                   @db.VarChar(255)
  serial_number        String?                   @db.VarChar(255)
  purchase_date        DateTime?                 @db.Date
  warranty_expiry      DateTime?                 @db.Date
  is_active            Boolean?                  @default(true)
  created_by           String?                   @db.VarChar(255)
  updated_by           String?                   @db.VarChar(255)
  created_at           DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?                 @default(now()) @db.Timestamptz(6)
  location_notes       String?                   @db.VarChar(255)
  brand                String?                   @db.VarChar(100)
  model_name           String?                   @db.VarChar(100)
  notes                String?
  expense_items        expense_inventory_items[]
  images               inventory_images[]
  category             inventory_categories?     @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  movements            inventory_movements[]
  maintenance_supplies maintenance_supplies[]
}

model inventory_images {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  inventory_item_id String          @db.Uuid
  image_url         String
  is_cover          Boolean?        @default(false)
  description       String?
  sort_order        Int?            @default(0)
  created_at        DateTime?       @default(now()) @db.Timestamptz(6)
  inventory_item    inventory_items @relation(fields: [inventory_item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model inventory_movements {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  inventory_item_id String          @db.Uuid
  organization_id   String?         @db.Uuid
  venue_id          String?         @db.Uuid
  type              String          @db.VarChar(50)
  quantity_change   Decimal         @db.Decimal
  reference_id      String?         @db.Uuid
  reference_type    String?         @db.VarChar(50)
  reason            String?
  created_by        String?         @db.VarChar(255)
  created_at        DateTime?       @default(now()) @db.Timestamptz(6)
  inventory_item    inventory_items @relation(fields: [inventory_item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model expense_inventory_items {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  expense_id        String          @db.Uuid
  inventory_item_id String          @db.Uuid
  quantity          Decimal         @db.Decimal
  unit_cost         Decimal?        @db.Decimal
  notes             String?
  created_at        DateTime?       @default(now()) @db.Timestamptz(6)
  expense           expenses        @relation(fields: [expense_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  inventory_item    inventory_items @relation(fields: [inventory_item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model maintenance_zones {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id  String?            @db.Uuid
  venue_id         String?            @db.Uuid
  name             String             @db.VarChar(255)
  type             String?            @db.VarChar(100)
  description      String?
  is_active        Boolean?           @default(true)
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @default(now()) @db.Timestamptz(6)
  notes            String?
  maintenance_logs maintenance_logs[]
  pending_tasks    pending_tasks[]
}

model maintenance_logs {
  id               String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id  String?                @db.Uuid
  venue_id         String?                @db.Uuid
  zone_id          String?                @db.Uuid
  provider_id      String?                @db.Uuid
  title            String?                @default("") @db.VarChar(255)
  description      String?
  status           String?                @default("pending") @db.VarChar(50)
  priority         String?                @default("normal") @db.VarChar(20)
  scheduled_date   DateTime?              @db.Timestamptz(6)
  started_at       DateTime?              @db.Timestamptz(6)
  completed_at     DateTime?              @db.Timestamptz(6)
  entry_time       String?                @db.VarChar(10)
  exit_time        String?                @db.VarChar(10)
  work_performed   String?
  pending_items    String?
  total_cost       Decimal?               @db.Decimal
  created_by       String?                @db.VarChar(255)
  updated_by       String?                @db.VarChar(255)
  created_at       DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?              @default(now()) @db.Timestamptz(6)
  maintenance_date DateTime?              @db.Date
  cost             Decimal?               @db.Decimal
  notes            String?
  images           maintenance_images[]
  provider         providers?             @relation(fields: [provider_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  zone             maintenance_zones?     @relation(fields: [zone_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  supplies         maintenance_supplies[]
}

model maintenance_supplies {
  id                 String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  maintenance_log_id String           @db.Uuid
  inventory_item_id  String           @db.Uuid
  quantity_used      Decimal          @db.Decimal
  unit_cost_at_time  Decimal?         @db.Decimal
  notes              String?
  created_at         DateTime?        @default(now()) @db.Timestamptz(6)
  inventory_item     inventory_items  @relation(fields: [inventory_item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  maintenance_log    maintenance_logs @relation(fields: [maintenance_log_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model maintenance_images {
  id                 String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  maintenance_log_id String           @db.Uuid
  image_url          String
  type               String?          @db.VarChar(50)
  description        String?          @db.Text
  sort_order         Int              @default(0)
  created_at         DateTime         @default(now()) @db.Timestamptz(6)
  maintenance_log    maintenance_logs @relation(fields: [maintenance_log_id], references: [id], onDelete: Cascade)
}

// ========================================
// PENDING TASKS MODULE
// ========================================

model pending_tasks {
  id                 String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organization_id    String?               @db.Uuid
  venue_id           String                @db.Uuid
  zone_id            String?               @db.Uuid
  title              String                @db.VarChar(255)
  description        String?               @db.Text
  priority           String                @default("medium") @db.VarChar(20)
  status             String                @default("pending") @db.VarChar(50)
  due_date           DateTime?             @db.Date
  completed_at       DateTime?             @db.Timestamptz(6)
  maintenance_log_id String?               @db.Uuid
  notes              String?               @db.Text
  created_by         String?               @db.VarChar(255)
  created_at         DateTime              @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?             @db.Timestamptz(6)
  updated_by         String?               @db.VarChar(255)
  zone               maintenance_zones?    @relation(fields: [zone_id], references: [id])
  images             pending_task_images[]
}

model pending_task_images {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pending_task_id String        @db.Uuid
  image_url       String        @db.Text
  description     String?       @db.Text
  sort_order      Int           @default(0)
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  pending_task    pending_tasks @relation(fields: [pending_task_id], references: [id], onDelete: Cascade)
}

// ========================================
// COMMISSIONS MODULE
// ========================================

model commission_agents {
  id              String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  provider_id     String                @db.Uuid
  organization_id String?               @db.Uuid
  venue_id        String?               @db.Uuid
  name            String                @db.VarChar(255)
  notes           String?               @db.Text
  is_active       Boolean               @default(true)
  created_by      String?               @db.VarChar(255)
  created_at      DateTime              @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?             @db.Timestamptz(6)
  updated_by      String?               @db.VarChar(255)
  provider        providers             @relation(fields: [provider_id], references: [id])
  rules           commission_rules[]
  payments        commission_payments[]
}

model commission_rules {
  id           String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agent_id     String            @db.Uuid
  plan_type    String            @db.VarChar(50)
  min_adults   Int               @default(1)
  max_adults   Int?
  rate_percent Decimal           @db.Decimal
  sort_order   Int               @default(0)
  created_at   DateTime          @default(now()) @db.Timestamptz(6)
  agent        commission_agents @relation(fields: [agent_id], references: [id], onDelete: Cascade)

  @@index([agent_id, plan_type, sort_order])
}

model commission_payments {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agent_id          String            @db.Uuid
  accommodation_id  String            @db.Uuid
  organization_id   String?           @db.Uuid
  venue_id          String?           @db.Uuid
  adults            Int
  agreed_price      Decimal           @db.Decimal
  calculated_amount Decimal           @db.Decimal
  status            String            @default("pending") @db.VarChar(50)
  payment_date      DateTime?         @db.Date
  payment_method    String?           @db.VarChar(100)
  reference         String?           @db.VarChar(255)
  receipt_url       String?           @db.Text
  expense_id        String?           @unique @db.Uuid
  notes             String?           @db.Text
  breakdown         Json?             @db.Json
  created_by        String?           @db.VarChar(255)
  created_at        DateTime          @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?         @db.Timestamptz(6)
  updated_by        String?           @db.VarChar(255)
  agent             commission_agents @relation(fields: [agent_id], references: [id])
}
